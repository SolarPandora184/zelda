<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Baseball Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #87CEEB;
    }
    canvas {
      display: block;
      margin: auto;
      background: #4CAF50;
    }
  </style>
</head>
<body>
<canvas id="game" width="800" height="400"></canvas>
<script>
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  let gameStarted = false;

  let ball = {
    x: 400,
    y: 150,
    radius: 8,
    speedX: 0,
    speedY: 0,
    active: false,
    hit: false
  };

  let bat = {
    x: 400,
    y: 300,
    width: 10,
    height: 60,
    angle: 0,
    swinging: false
  };

  let runner = {
    x: 400,
    y: 390,
    running: false,
    stage: 0 // 0 = home, 1 = to first, 2 = to second, 3 = stopped
  };

  const firstBase = { x: 600, y: 300 };
  const secondBase = { x: 500, y: 150 };

  function drawField() {
    ctx.fillStyle = '#4CAF50';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Pitcher's mound
    ctx.fillStyle = '#D2B48C';
    ctx.beginPath();
    ctx.arc(400, 150, 20, 0, Math.PI * 2);
    ctx.fill();

    // Home plate
    ctx.fillStyle = 'white';
    ctx.beginPath();
    ctx.moveTo(390, 370);
    ctx.lineTo(410, 370);
    ctx.lineTo(415, 390);
    ctx.lineTo(385, 390);
    ctx.closePath();
    ctx.fill();

    // First base
    ctx.fillStyle = 'white';
    ctx.fillRect(firstBase.x - 10, firstBase.y - 10, 20, 20);

    // Second base
    ctx.fillStyle = 'white';
    ctx.fillRect(secondBase.x - 10, secondBase.y - 10, 20, 20);
  }

  function drawBall() {
    if (ball.active) {
      ctx.fillStyle = 'white';
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function drawBat() {
    ctx.save();
    ctx.translate(bat.x, bat.y);
    ctx.rotate(bat.angle);
    ctx.fillStyle = '#8B4513';
    ctx.fillRect(-bat.width / 2, -bat.height, bat.width, bat.height);
    ctx.restore();
  }

  function drawRunner() {
    if (runner.stage > 0 && runner.stage <= 3) {
      ctx.fillStyle = 'blue';
      ctx.beginPath();
      ctx.arc(runner.x, runner.y, 10, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function pitchBall() {
    ball.x = 400;
    ball.y = 150;
    ball.speedY = 3;
    ball.speedX = (Math.random() - 0.5) * 2;
    ball.active = true;
    ball.hit = false;
  }

  function updateBall() {
    if (ball.active) {
      ball.x += ball.speedX;
      ball.y += ball.speedY;

      if (ball.y > 380 && !ball.hit) {
        ball.active = false;
        setTimeout(pitchBall, 1000);
      }

      if (ball.hit && (ball.x < 0 || ball.x > 800 || ball.y < 0)) {
        ball.active = false;
        setTimeout(pitchBall, 1000);
      }
    }
  }

  function updateRunner() {
    if (runner.stage === 1) {
      moveToBase(firstBase.x, firstBase.y, () => {
        runner.stage = 2;
      });
    } else if (runner.stage === 2) {
      moveToBase(secondBase.x, secondBase.y, () => {
        runner.stage = 3; // stop at second
      });
    }
  }

  function moveToBase(baseX, baseY, onArrive) {
    const dx = baseX - runner.x;
    const dy = baseY - runner.y;
    const dist = Math.hypot(dx, dy);

    if (dist < 5) {
      onArrive();
    } else {
      runner.x += dx / dist * 2;
      runner.y += dy / dist * 2;
    }
  }

  function swingBat() {
    if (!bat.swinging) {
      bat.swinging = true;
      let swingAngle = 0;
      const swingInterval = setInterval(() => {
        swingAngle += 0.2;
        bat.angle = swingAngle;
        if (swingAngle >= 1.2) {
          clearInterval(swingInterval);
          bat.angle = 0;
          bat.swinging = false;
        }
      }, 16);

      // Check collision
      if (
        ball.active &&
        ball.y > bat.y - bat.height &&
        ball.y < bat.y &&
        Math.abs(ball.x - bat.x) < 30
      ) {
        ball.speedY = -6;
        ball.speedX *= 3;
        ball.hit = true;
        runner.x = 400;
        runner.y = 390;
        runner.stage = 1; // start to first
      }
    }
  }

  function loop() {
    drawField();
    drawBall();
    drawBat();
    drawRunner();
    updateBall();
    updateRunner();
    requestAnimationFrame(loop);
  }

  canvas.addEventListener('click', () => {
    if (!gameStarted) {
      gameStarted = true;
      pitchBall();
    } else {
      swingBat();
    }
  });

  loop();
</script>
</body>
</html>
