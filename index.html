<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Zombie Survival Game</title>
  <style>
    html, body {
      margin: 0;
      background: #111;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: auto;
      background: #333;
      border: 2px solid #222;
    }
  </style>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let keys = {};
let bullets = [];
let zombies = [];
let healthPacks = [];

const player = {
  x: 400, y: 300, r: 20, speed: 3, health: 100, ammo: 10, maxAmmo: 10, score: 0,
  reloading: false
};

let mouse = { x: 0, y: 0 };
let gameOver = false;
let wave = 1;
let spawnCooldown = 0;

document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  mouse.x = e.clientX - rect.left;
  mouse.y = e.clientY - rect.top;
});
canvas.addEventListener('mousedown', shoot);

function shoot() {
  if (player.ammo > 0 && !player.reloading && !gameOver) {
    const angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
    bullets.push({ x: player.x, y: player.y, dx: Math.cos(angle) * 8, dy: Math.sin(angle) * 8 });
    player.ammo--;
  }
}

document.addEventListener('keydown', e => {
  if (e.key === 'r' && !player.reloading && !gameOver) {
    reload();
  }
});

function reload() {
  player.reloading = true;
  setTimeout(() => {
    player.ammo = player.maxAmmo;
    player.reloading = false;
  }, 1000);
}

function spawnZombie() {
  const edges = [
    { x: Math.random() * canvas.width, y: -30 },
    { x: Math.random() * canvas.width, y: canvas.height + 30 },
    { x: -30, y: Math.random() * canvas.height },
    { x: canvas.width + 30, y: Math.random() * canvas.height }
  ];
  const pos = edges[Math.floor(Math.random() * edges.length)];
  zombies.push({ x: pos.x, y: pos.y, r: 20, speed: 1.5 + Math.random(), hit: false });
}

function spawnHealthPack() {
  healthPacks.push({
    x: 50 + Math.random() * 700,
    y: 50 + Math.random() * 500,
    r: 10,
    active: true
  });
}

function update() {
  if (gameOver) return;

  // Movement
  if (keys['w']) player.y -= player.speed;
  if (keys['s']) player.y += player.speed;
  if (keys['a']) player.x -= player.speed;
  if (keys['d']) player.x += player.speed;

  // Bullets
  bullets.forEach(b => {
    b.x += b.dx;
    b.y += b.dy;
  });
  bullets = bullets.filter(b => b.x > 0 && b.x < canvas.width && b.y > 0 && b.y < canvas.height);

  // Zombies follow
  zombies.forEach(z => {
    const angle = Math.atan2(player.y - z.y, player.x - z.x);
    z.x += Math.cos(angle) * z.speed;
    z.y += Math.sin(angle) * z.speed;
  });

  // Collision: bullets vs zombies
  bullets.forEach((b, i) => {
    zombies.forEach((z, j) => {
      const dist = Math.hypot(b.x - z.x, b.y - z.y);
      if (dist < z.r) {
        zombies.splice(j, 1);
        bullets.splice(i, 1);
        player.score++;
      }
    });
  });

  // Collision: zombies vs player
  zombies.forEach(z => {
    const dist = Math.hypot(player.x - z.x, player.y - z.y);
    if (dist < player.r + z.r) {
      player.health -= 0.5;
      if (player.health <= 0) {
        player.health = 0;
        gameOver = true;
      }
    }
  });

  // Health pack pickup
  healthPacks.forEach((p, i) => {
    const dist = Math.hypot(player.x - p.x, player.y - p.y);
    if (dist < player.r + p.r && p.active) {
      player.health = Math.min(player.health + 30, 100);
      p.active = false;
    }
  });

  // Spawn logic
  if (spawnCooldown <= 0) {
    for (let i = 0; i < wave; i++) spawnZombie();
    if (Math.random() < 0.3) spawnHealthPack();
    spawnCooldown = 400;
    wave++;
  } else {
    spawnCooldown--;
  }
}

function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Player
  ctx.fillStyle = 'cyan';
  ctx.beginPath();
  ctx.arc(player.x, player.y, player.r, 0, Math.PI * 2);
  ctx.fill();

  // Gun direction line
  ctx.strokeStyle = 'white';
  ctx.beginPath();
  ctx.moveTo(player.x, player.y);
  ctx.lineTo(mouse.x, mouse.y);
  ctx.stroke();

  // Bullets
  ctx.fillStyle = 'yellow';
  bullets.forEach(b => {
    ctx.beginPath();
    ctx.arc(b.x, b.y, 5, 0, Math.PI * 2);
    ctx.fill();
  });

  // Zombies
  ctx.fillStyle = 'green';
  zombies.forEach(z => {
    ctx.beginPath();
    ctx.arc(z.x, z.y, z.r, 0, Math.PI * 2);
    ctx.fill();
  });

  // Health packs
  healthPacks.forEach(p => {
    if (p.active) {
      ctx.fillStyle = 'red';
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
    }
  });

  // UI
  ctx.fillStyle = 'white';
  ctx.font = '16px monospace';
  ctx.fillText(`Health: ${Math.floor(player.health)}  Ammo: ${player.ammo}/${player.maxAmmo}  Score: ${player.score}  Wave: ${wave}`, 10, 20);
  if (player.reloading) ctx.fillText(`Reloading...`, 10, 40);

  if (gameOver) {
    ctx.fillStyle = 'rgba(0,0,0,0.7)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = 'red';
    ctx.font = '40px sans-serif';
    ctx.fillText('GAME OVER', 300, 300);
    ctx.font = '20px sans-serif';
    ctx.fillText(`Score: ${player.score}`, 350, 340);
  }
}

function gameLoop() {
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
